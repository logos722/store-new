# Быстрый старт: Согласие на обработку персональных данных

## 🎯 Что было реализовано

Добавлен обязательный чекбокс согласия на обработку персональных данных в форму оформления заказа с автоматической блокировкой полей.

## 📁 Измененные файлы

```
src/
├── app/
│   ├── privacy/
│   │   └── page.tsx                          # ✨ НОВОЕ: Страница политики
│   └── cart/
│       └── page.tsx                          # Без изменений (обратная совместимость)
├── shared/
│   └── components/
│       └── orderModal/
│           ├── OrderModal.tsx                # ✅ Обновлено: Логика блокировки
│           └── OrderModal.module.scss        # ✅ Обновлено: Стили + mobile
└── types/
    └── order.ts                              # ✅ Обновлено: Добавлено privacyConsent
```

## 🚀 Как это работает

### 1. Начальное состояние

```
┌─────────────────────────────┐
│ [☐] Я согласен с политикой  │ ← Чекбокс АКТИВЕН
└─────────────────────────────┘
┌─────────────────────────────┐
│ Email: [_____________] 🔒   │ ← Поля ЗАБЛОКИРОВАНЫ
│ Имя:   [_____________] 🔒   │
│ ...                         │
│ [Подтвердить заказ] 🔒      │ ← Кнопка ЗАБЛОКИРОВАНА
└─────────────────────────────┘
```

### 2. После согласия

```
┌─────────────────────────────┐
│ [☑] Я согласен с политикой  │ ← Пользователь согласился
└─────────────────────────────┘
┌─────────────────────────────┐
│ Email: [_____________] ✓    │ ← Поля РАЗБЛОКИРОВАНЫ
│ Имя:   [_____________] ✓    │
│ ...                         │
│ [Подтвердить заказ] ✓       │ ← Кнопка АКТИВНА
└─────────────────────────────┘
```

### 3. Попытка отправки без согласия

```
┌─────────────────────────────┐
│ [☐] Я согласен с политикой  │
│ ⚠️ Необходимо согласие!     │ ← Показывается ошибка
└─────────────────────────────┘
```

## 💻 Использование в коде

### Компонент автоматически обрабатывает всё:

```tsx
<OrderModal
  isOpen={isOrderModalOpen}
  onClose={() => setIsOrderModalOpen(false)}
  onSubmit={handleOrderSubmit} // Получит privacyConsent: true
/>
```

### Данные в handleOrderSubmit:

```typescript
{
  email: "user@example.com",
  name: "Иван Иванов",
  phone: "+7 999 123-45-67",
  city: "Москва",
  comment: "Позвонить перед доставкой",
  privacyConsent: true  // ← Новое поле
}
```

## 🎨 Стили и адаптивность

### Desktop (> 768px)

- Полный размер чекбокса: 20x20px
- Стандартные отступы

### Mobile (≤ 480px)

- Чекбокс: 18x18px
- Уменьшенные отступы
- font-size: 16px (предотвращает zoom на iOS)
- Адаптивная высота модального окна

## ♿ Доступность (A11y)

Реализованы все необходимые ARIA атрибуты:

```tsx
<input
  type="checkbox"
  aria-required="true"          // Обязательное поле
  aria-invalid={consentError}   // Состояние ошибки
  aria-describedby="error-id"   // Связь с сообщением об ошибке
/>

<span role="alert">             // Screen reader озвучит ошибку
  Необходимо согласие
</span>
```

## 🔧 Настройка (опционально)

### Изменить текст согласия:

```tsx
// OrderModal.tsx, строка ~146
<span className={styles.consentText}>
  Я согласен с{' '}
  <Link href="/privacy" ...>
    политикой обработки персональных данных
  </Link>{' '}
  *
</span>
```

### Изменить путь к политике:

```tsx
// OrderModal.tsx, строка ~148
<Link href="/privacy" ...>  // ← Изменить здесь
```

### Изменить цвета чекбокса:

```scss
// OrderModal.module.scss, строка ~212
.consentCheckbox {
  accent-color: #007bff; // ← Цвет чекбокса
}
```

## ✅ Проверка работоспособности

1. Откройте страницу корзины: `http://localhost:3000/cart`
2. Добавьте товары в корзину
3. Нажмите "Оформить заказ"
4. Убедитесь, что:
   - ✅ Чекбокс не отмечен по умолчанию
   - ✅ Все поля серые и заблокированы
   - ✅ Кнопка заблокирована
   - ✅ После установки чекбокса всё разблокируется
   - ✅ Ссылка на политику открывается в новой вкладке

## 📱 Тестирование на мобильных

```bash
# Chrome DevTools
1. F12 → Toggle device toolbar
2. Выберите iPhone/Android
3. Проверьте адаптивность

# Реальное устройство
1. Найдите IP компьютера: ipconfig/ifconfig
2. Откройте на телефоне: http://YOUR_IP:3000/cart
```

## 🐛 Troubleshooting

### Проблема: Поля не блокируются

**Решение:** Проверьте, что `privacyConsent` по умолчанию `false`

### Проблема: Стили не применяются

**Решение:** Очистите кэш Next.js

```bash
rm -rf .next
npm run dev
```

### Проблема: TypeScript ошибки

**Решение:** Проверьте, что `order.ts` содержит поле `privacyConsent: boolean`

### Проблема: Linter ошибки

**Решение:** Запустите Prettier

```bash
npm run format
```

## 📊 Мониторинг (рекомендации)

Добавьте аналитику для отслеживания:

```tsx
const handleConsentChange = e => {
  // ... existing code

  // Добавьте аналитику
  if (checked) {
    analytics.track('Privacy Consent Given', {
      page: 'order_modal',
      timestamp: new Date().toISOString(),
    });
  }
};
```

## 📚 Дополнительная информация

Подробная документация: [PRIVACY_CONSENT_IMPLEMENTATION.md](./PRIVACY_CONSENT_IMPLEMENTATION.md)

## 🤝 Поддержка

При возникновении проблем:

1. Проверьте [Troubleshooting](#-troubleshooting)
2. Изучите [подробную документацию](./PRIVACY_CONSENT_IMPLEMENTATION.md)
3. Обратитесь к команде разработки

---

**Последнее обновление:** 20.10.2025
